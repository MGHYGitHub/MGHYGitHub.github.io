const changeContent=e=>{if(""===e)return e;return(e=[{regex:/<img.*?src="(.*?)"?[^\>]+>/gi,replacement:"[图片]"},{regex:/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,replacement:"[链接]"},{regex:/<pre><code>.*?<\/pre>/gi,replacement:"[代码]"},{regex:/<[^>]+>/g,replacement:""}].reduce(((e,{regex:n,replacement:t})=>e.replace(n,t)),e)).length>150?e.substring(0,150)+"...":e},getComment=()=>{const e=document.querySelector("#card-newest-comments .aside-list");twikoo.getRecentComments({envId:GLOBAL_CONFIG.comment.twikoo.url,region:"",pageSize:6,includeReply:!0}).then((function(e){const n=e.map((e=>({content:changeContent(e.comment),avatar:e.avatar,nick:e.nick,url:`${e.url}#${e.id}`,date:new Date(e.created).toISOString()})));generateHtml(n)})).catch((function(n){e.innerHTML="无法获取评论，请确认相关配置是否正确"}))},generateHtml=e=>{const n=document.querySelector("#card-newest-comments .aside-list");n.innerHTML=e.length?e.map((e=>`\n    <div class='aside-list-item'>\n      <a href='${e.url}' class='thumbnail'>\n        <img src='${e.avatar}' alt='${e.nick}'>\n        <div class='name'><span>${e.nick}</span></div>\n      </a>\n      <div class='content'>\n        <a class='comment' href='${e.url}'>${e.content}</a>\n        <time class="datetime" datetime="${e.date}"></time>\n      </div>\n    </div>\n  `)).join(""):"没有评论",window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n),changeTimeFormat()},newestCommentInit=()=>{document.querySelector("#card-newest-comments .aside-list")&&getComment()};newestCommentInit();