window.onload=()=>{let e,t=[];const n=document.getElementById("search-mask"),c=document.querySelector("#local-search .search-dialog"),s=()=>{window.innerWidth<768&&c.style.setProperty("--search-height",window.innerHeight+"px")},o=()=>{utils.animateOut(c,"search_close .5s"),utils.animateOut(n,"to_hide 0.5s"),window.removeEventListener("resize",s)};utils.addEventListenerPjax(document.querySelector("#search-button > .search"),"click",(()=>{utils.animateIn(n,"to_show 0.5s"),c.style.display="block",setTimeout((()=>{document.querySelector("#local-search .search-box-input").focus()}),100),document.addEventListener("keydown",(function e(t){"Escape"===t.code&&(o(),document.removeEventListener("keydown",e))})),s(),window.addEventListener("resize",s)})),utils.addEventListenerPjax(document.querySelector("#local-search .search-close-button"),"click",o);let i="",a=0;const l=10;let r=[];function d(){const e=document.getElementById("search-results");document.getElementById("search-input").addEventListener("keydown",(function(n){13===n.keyCode&&(n.preventDefault(),e.innerHTML="",i=this.value.trim(),""!==i?(r=function(e){const n=new RegExp(e.split("").join(".*"),"i");return t.filter((e=>n.test(e.title)||n.test(e.content)))}(i),u(r,a),function(e){const t=Math.ceil(e/l),n=document.getElementById("search-pagination");n.innerHTML="";const c=document.createElement("ul");c.className="pagination-list";for(let e=0;e<t;e++){const t=document.createElement("li");t.className="pagination-item",t.textContent=e+1,e===a&&t.classList.add("select"),t.addEventListener("click",(function(){a=e,u(r,e),document.querySelectorAll(".pagination-item").forEach((function(e){e.classList.remove("select")})),t.classList.add("select")})),c.appendChild(t)}n.appendChild(c)}(r.length)):function(){const e=document.getElementById("search-results"),t=document.getElementById("search-pagination"),n=document.getElementById("search-tips");e.innerHTML="",t.innerHTML="",n.innerHTML=""}())}))}function u(e,t){const n=document.getElementById("search-results");n.innerHTML="";const c=document.getElementById("search-tips");c.innerHTML="";const s=t*l,o=s+l;if(!e.length){const e=document.createElement("span");return e.className="search-result-empty",e.textContent=GLOBAL_CONFIG.lang.search.empty.replace(/\$\{query}/,i),void n.appendChild(e)}e.slice(s,o).forEach((function(e){const t=document.createElement("li");t.className="search-result-item";const c=document.createElement("a");c.className="search-result-title",c.href=e.link;const s=function(e,t){const n=new RegExp(`(${t.split(" ").join("|")})`,"gi");return e.replace(n,"<em>$1</em>")}(e.title,i);c.innerHTML=s,t.appendChild(c),n.appendChild(t)}));const a=document.createElement("span");a.className="search-result-count",a.innerHTML=`共 <b>${e.length}</b> 条结果`,c.appendChild(a)}fetch("/search.xml").then((e=>e.text())).then((n=>{let c=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("entry");for(let e=0;e<c.length;e++){let n=c[e],s=n.getElementsByTagName("title")[0].textContent,o=n.getElementsByTagName("url")[0].textContent,i=n.getElementsByTagName("content")[0].textContent;t.push({title:s,link:o,content:i})}e=lunr((function(){this.ref("link"),this.field("title",{boost:10}),this.field("content"),t.forEach((function(e){this.add(e)}),this)}))})).catch((e=>console.error("Error loading search data:",e))),d(),window.addEventListener("DOMContentLoaded",(e=>{d()}))};